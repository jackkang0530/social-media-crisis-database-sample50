<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„° ë¶„ì„ í”Œë«í¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: 1fr 200px 150px;
            gap: 15px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #3498db;
        }

        .filter-select {
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .results-info {
            background: #ecf0f1;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            color: #7f8c8d;
        }

        .table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 70vh;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th {
            background: #34495e;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
            border-right: 1px solid #2c3e50;
        }

        th:hover {
            background: #2c3e50;
        }

        th.sortable::after {
            content: " â†•";
            opacity: 0.5;
            font-size: 12px;
        }

        th.sort-asc::after {
            content: " â†‘";
            opacity: 1;
            color: #3498db;
        }

        th.sort-desc::after {
            content: " â†“";
            opacity: 1;
            color: #3498db;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #ecf0f1;
            border-right: 1px solid #ecf0f1;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        tr:nth-child(even) {
            background-color: #fdfdfd;
        }

        tr:nth-child(even):hover {
            background-color: #f8f9fa;
        }

        .link-cell {
            color: #3498db;
            text-decoration: none;
        }

        .link-cell:hover {
            text-decoration: underline;
        }

        .pagination {
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 2px solid #e1e8ed;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .pagination button:hover:not(:disabled) {
            background: #f8f9fa;
            border-color: #3498db;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination .current-page {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        /* í•„í„° ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .filter-header {
            position: relative;
        }

        .filter-button {
            display: inline-block;
            margin-left: 8px;
            cursor: pointer;
            color: #bdc3c7;
            font-size: 12px;
            transition: color 0.2s;
        }

        .filter-button:hover {
            color: #3498db;
        }

        .filter-button.active {
            color: #e74c3c;
        }

        .filter-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 6px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 250px;
            max-width: 400px;
            max-height: 300px;
            display: none;
        }

        .filter-dropdown.show {
            display: block;
        }

        .filter-search {
            padding: 10px;
            border-bottom: 1px solid #ecf0f1;
        }

        .filter-search input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e1e8ed;
            border-radius: 4px;
            font-size: 13px;
        }

        .filter-options {
            max-height: 200px;
            overflow-y: auto;
            padding: 5px 0;
        }

        .filter-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.2s;
            min-height: 32px;
            border-bottom: 1px solid #f8f9fa;
        }

        .filter-option:hover {
            background-color: #f8f9fa;
        }

        .filter-option input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .filter-option-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #2c3e50;
            font-weight: 400;
            line-height: 1.4;
        }

        .filter-option-count {
            color: #7f8c8d;
            font-size: 12px;
            margin-left: 8px;
            flex-shrink: 0;
            font-weight: 500;
        }

        .filter-actions {
            padding: 10px;
            border-top: 1px solid #ecf0f1;
            display: flex;
            gap: 8px;
        }

        .filter-actions button {
            padding: 6px 12px;
            border: 1px solid #e1e8ed;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            background: white;
        }

        .filter-actions .apply-btn {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .filter-actions .clear-btn {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .container {
                padding: 10px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px 6px;
                max-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ë°ì´í„° ë¶„ì„ í”Œë«í¼</h1>
            <p>66,000ê°œ ì´ìƒì˜ ë°ì´í„°ë¥¼ ê²€ìƒ‰, í•„í„°ë§, ì •ë ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•˜ì„¸ìš”... (ì œëª©, ë‚´ìš©, ì¶œì²˜ ë“±)">
            </div>
            <select id="categoryFilter" class="filter-select">
                <option value="">ëª¨ë“  ì¹´í…Œê³ ë¦¬</option>
                <option value="Deceptive & Fraudulent Behavior_Fraud">ì‚¬ê¸°</option>
                <option value="Deceptive & Fraudulent Behavior_Impersonation">ì‚¬ì¹­</option>
            </select>
            <div class="results-info" id="resultsInfo">
                ì´ 2ê°œ í•­ëª©
            </div>
        </div>

        <div class="table-container">
            <div class="table-wrapper">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th class="sortable" data-column="0">Event Num</th>
                            <th class="sortable" data-column="1">Event Title</th>
                            <th class="sortable" data-column="2">Article Set</th>
                            <th class="sortable" data-column="3">Selected Article</th>
                            <th class="sortable" data-column="4">
                                Stakeholder
                                <span class="filter-button" data-filter="stakeholder">ğŸ”½</span>
                            </th>
                            <th class="sortable" data-column="5">
                                Giver
                                <span class="filter-button" data-filter="giver">ğŸ”½</span>
                            </th>
                            <th class="sortable" data-column="6">
                                Receiver
                                <span class="filter-button" data-filter="receiver">ğŸ”½</span>
                            </th>
                            <th class="sortable" data-column="7">
                                Problematic Behavior
                                <span class="filter-button" data-filter="behavior">ğŸ”½</span>
                            </th>
                            <th class="sortable" data-column="8">Aftermath</th>
                            <th class="sortable" data-column="9">
                                Platform
                                <span class="filter-button" data-filter="platform">ğŸ”½</span>
                            </th>
                            <th class="sortable" data-column="10">Link</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="11" class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="pagination" id="pagination">
                <button id="firstPage">ì²˜ìŒ</button>
                <button id="prevPage">ì´ì „</button>
                <span id="pageInfo">1 / 1</span>
                <button id="nextPage">ë‹¤ìŒ</button>
                <button id="lastPage">ë§ˆì§€ë§‰</button>
            </div>
        </div>

        <!-- í•„í„° ë“œë¡­ë‹¤ìš´ë“¤ì„ ë³„ë„ ì˜ì—­ì— ë°°ì¹˜ -->
        <div id="filter-dropdowns">
            <div class="filter-dropdown" id="filter-stakeholder">
                <div class="filter-search">
                    <input type="text" placeholder="ê²€ìƒ‰..." class="filter-search-input">
                </div>
                <div class="filter-options"></div>
                <div class="filter-actions">
                    <button class="apply-btn">ì ìš©</button>
                    <button class="clear-btn">ì „ì²´ì„ íƒ</button>
                </div>
            </div>
            
            <div class="filter-dropdown" id="filter-giver">
                <div class="filter-search">
                    <input type="text" placeholder="ê²€ìƒ‰..." class="filter-search-input">
                </div>
                <div class="filter-options"></div>
                <div class="filter-actions">
                    <button class="apply-btn">ì ìš©</button>
                    <button class="clear-btn">ì „ì²´ì„ íƒ</button>
                </div>
            </div>
            
            <div class="filter-dropdown" id="filter-receiver">
                <div class="filter-search">
                    <input type="text" placeholder="ê²€ìƒ‰..." class="filter-search-input">
                </div>
                <div class="filter-options"></div>
                <div class="filter-actions">
                    <button class="apply-btn">ì ìš©</button>
                    <button class="clear-btn">ì „ì²´ì„ íƒ</button>
                </div>
            </div>
            
            <div class="filter-dropdown" id="filter-behavior">
                <div class="filter-search">
                    <input type="text" placeholder="ê²€ìƒ‰..." class="filter-search-input">
                </div>
                <div class="filter-options"></div>
                <div class="filter-actions">
                    <button class="apply-btn">ì ìš©</button>
                    <button class="clear-btn">ì „ì²´ì„ íƒ</button>
                </div>
            </div>
            
            <div class="filter-dropdown" id="filter-platform">
                <div class="filter-search">
                    <input type="text" placeholder="ê²€ìƒ‰..." class="filter-search-input">
                </div>
                <div class="filter-options"></div>
                <div class="filter-actions">
                    <button class="apply-btn">ì ìš©</button>
                    <button class="clear-btn">ì „ì²´ì„ íƒ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ìƒ˜í”Œ ë°ì´í„° (ì‹¤ì œë¡œëŠ” CSVì—ì„œ ë¡œë“œ)
        const sampleData = [
            ["3909", "Face-changed images cause stir online", "(''Face-changed' images cause stir online', 'people's daily ', '2019-02-27')", "(''Face-changed' images cause stir online', 'people's daily ', '2019-02-27')", "1-r->1-i", "1-r", "1-i", "Deceptive & Fraudulent Behavior_Impersonation", "", "Bilibili (streaming site)", "http://en.chinaculture.org/2019-02/27/content_1353051.htm"],
            ["43981", "Maximum complaints with cyber police station related to social media", "(''Maximum complaints with cyber police station related to social media'', 'the times of india', '2017-05-22')", "(''Maximum complaints with cyber police station related to social media'', 'the times of india', '2017-05-22')", "1-i->1-r", "1-i", "1-r", "Deceptive & Fraudulent Behavior_Fraud", "Protective Measures", "Online", "https://timesofindia.indiatimes.com/city/nashik/maximum-complaints-with-cyber-police-station-related-to-social-media/articleshow/58779933.cms"]
        ];

        let currentData = [...sampleData];
        let filteredData = [...sampleData];
        let currentPage = 1;
        const itemsPerPage = 50;
        let sortColumn = -1;
        let sortDirection = 'asc';
        
        // ì»¬ëŸ¼ë³„ í•„í„° ìƒíƒœ
        const columnFilters = {
            stakeholder: new Set(),
            giver: new Set(),
            receiver: new Set(),
            behavior: new Set(),
            platform: new Set()
        };
        
        // í•„í„° ê°€ëŠ¥í•œ ì»¬ëŸ¼ ë§¤í•‘
        const filterColumns = {
            stakeholder: 4,
            giver: 5,
            receiver: 6,
            behavior: 7,
            platform: 9
        };

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadCSVFile(); // CSV íŒŒì¼ ìë™ ë¡œë“œ
        });

        // CSV íŒŒì¼ ìë™ ë¡œë“œ í•¨ìˆ˜
        async function loadCSVFile() {
            try {
                showLoadingState();
                
                console.log('CSV íŒŒì¼ ë¡œë“œ ì‹œë„ ì¤‘...');
                
                // data.csv íŒŒì¼ì„ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch('data.csv');
                console.log('Fetch ì‘ë‹µ:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`CSV íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
                }
                
                const csvText = await response.text();
                console.log('CSV íŒŒì¼ ë¡œë“œ ì™„ë£Œ, í¬ê¸°:', csvText.length);
                console.log('CSV ì²« 100ì:', csvText.substring(0, 100));
                
                // CSV íŒŒì‹±
                const parsedData = await parseCSVData(csvText);
                console.log('íŒŒì‹±ëœ ë°ì´í„° ê°œìˆ˜:', parsedData.length);
                
                if (parsedData.length > 0) {
                    currentData = parsedData;
                    console.log('ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    throw new Error('íŒŒì‹±ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('CSV ë¡œë“œ ì‹¤íŒ¨:', error);
                console.log('ìƒ˜í”Œ ë°ì´í„°ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.');
                
                // ìƒ˜í”Œ ë°ì´í„°ë¡œ ëŒ€ì²´
                currentData = [...sampleData];
                
                // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                const resultsInfo = document.getElementById('resultsInfo');
                resultsInfo.textContent = 'CSV íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ìƒ˜í”Œ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤';
                resultsInfo.style.background = '#e74c3c';
                resultsInfo.style.color = 'white';
                
            } finally {
                loadData(); // ë°ì´í„° ë¡œë“œ ë° ì´ˆê¸°í™”
                hideLoadingState();
            }
        }

        function showLoadingState() {
            const resultsInfo = document.getElementById('resultsInfo');
            resultsInfo.textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
            resultsInfo.style.background = '#3498db';
            resultsInfo.style.color = 'white';
            
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '<tr><td colspan="11" class="loading">ğŸ“Š ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...<br><small>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</small></td></tr>';
        }

        function hideLoadingState() {
            const resultsInfo = document.getElementById('resultsInfo');
            resultsInfo.style.background = '#ecf0f1';
            resultsInfo.style.color = '#7f8c8d';
        }

        async function parseCSVData(csvText) {
            if (!csvText || csvText.trim().length === 0) {
                console.error('CSV í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                return [];
            }
            
            const lines = csvText.trim().split('\n');
            const data = [];
            
            console.log('ì´ ë¼ì¸ ìˆ˜:', lines.length);
            
            // í—¤ë” í™•ì¸
            if (lines.length < 2) {
                console.error('CSV íŒŒì¼ì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ë¼ì¸ ìˆ˜:', lines.length);
                return [];
            }
            
            const header = parseCSVLine(lines[0]);
            console.log('í—¤ë”:', header);
            console.log('í—¤ë” ì»¬ëŸ¼ ìˆ˜:', header.length);
            
            // ì˜ˆìƒë˜ëŠ” í—¤ë”ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
            const expectedColumns = ["Event Num","Event Title","Article Set","Selected Article","Stakeholder","Giver","Receiver","Problematic Behavior","Aftermath","Platform","Link"];
            
            if (header.length !== expectedColumns.length) {
                console.warn(`í—¤ë” ì»¬ëŸ¼ ìˆ˜ê°€ ì˜ˆìƒê³¼ ë‹¤ë¦…ë‹ˆë‹¤. ì˜ˆìƒ: ${expectedColumns.length}, ì‹¤ì œ: ${header.length}`);
            }
            
            let successCount = 0;
            let errorCount = 0;
            
            for (let i = 1; i < lines.length; i++) {
                try {
                    const line = lines[i].trim();
                    if (!line) continue; // ë¹ˆ ë¼ì¸ ê±´ë„ˆë›°ê¸°
                    
                    const row = parseCSVLine(line);
                    
                    // ê¸°ë³¸ì ì¸ ìœ íš¨ì„± ê²€ì‚¬
                    if (row.length >= 10 && row[0] && row[0].trim()) { // ìµœì†Œ 10ê°œ ì»¬ëŸ¼ê³¼ Event Num ì¡´ì¬
                        // ë¶€ì¡±í•œ ì»¬ëŸ¼ì€ ë¹ˆ ë¬¸ìì—´ë¡œ ì±„ìš°ê¸°
                        while (row.length < expectedColumns.length) {
                            row.push('');
                        }
                        data.push(row);
                        successCount++;
                    } else {
                        errorCount++;
                        if (errorCount <= 5) { // ì²˜ìŒ 5ê°œ ì—ëŸ¬ë§Œ ë¡œê·¸
                            console.warn(`ë¼ì¸ ${i} ê±´ë„ˆë›°ê¸° - ì»¬ëŸ¼ ìˆ˜: ${row.length}, ì²« ë²ˆì§¸ ê°’: "${row[0]}"`);
                        }
                    }
                } catch (error) {
                    errorCount++;
                    if (errorCount <= 5) {
                        console.warn(`ë¼ì¸ ${i} íŒŒì‹± ì‹¤íŒ¨:`, error.message);
                    }
                }
                
                // ì§„í–‰ìƒí™© í‘œì‹œ (í° íŒŒì¼ìš©) - UI ë¸”ë¡ ë°©ì§€ë¥¼ ìœ„í•œ ë¹„ë™ê¸° ì²˜ë¦¬
                if (i % 5000 === 0) {
                    console.log(`íŒŒì‹± ì§„í–‰ë¥ : ${Math.round((i / lines.length) * 100)}% (ì„±ê³µ: ${successCount}, ì‹¤íŒ¨: ${errorCount})`);
                    
                    // ì§„í–‰ë¥  í‘œì‹œ ì—…ë°ì´íŠ¸
                    const resultsInfo = document.getElementById('resultsInfo');
                    resultsInfo.textContent = `ë°ì´í„° íŒŒì‹± ì¤‘... ${Math.round((i / lines.length) * 100)}%`;
                    
                    await new Promise(resolve => setTimeout(resolve, 1)); // UI ë¸”ë¡ ë°©ì§€
                }
            }
            
            console.log(`íŒŒì‹± ì™„ë£Œ - ì„±ê³µ: ${successCount}ê°œ, ì‹¤íŒ¨: ${errorCount}ê°œ`);
            return data;
        }

        function setupEventListeners() {
            // ê²€ìƒ‰
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            // ì¹´í…Œê³ ë¦¬ í•„í„°
            document.getElementById('categoryFilter').addEventListener('change', handleFilter);
            
            // ì •ë ¬
            document.querySelectorAll('th.sortable').forEach(th => {
                th.addEventListener('click', (e) => {
                    // í•„í„° ë²„íŠ¼ì´ í´ë¦­ëœ ê²½ìš° ì •ë ¬ ì´ë²¤íŠ¸ ë°©ì§€
                    if (e.target.classList.contains('filter-button')) {
                        e.stopPropagation();
                        return;
                    }
                    handleSort(parseInt(th.dataset.column));
                });
            });

            // í˜ì´ì§€ë„¤ì´ì…˜
            document.getElementById('firstPage').addEventListener('click', () => goToPage(1));
            document.getElementById('prevPage').addEventListener('click', () => goToPage(currentPage - 1));
            document.getElementById('nextPage').addEventListener('click', () => goToPage(currentPage + 1));
            document.getElementById('lastPage').addEventListener('click', () => goToPage(Math.ceil(filteredData.length / itemsPerPage)));
            
            // ì»¬ëŸ¼ í•„í„° ì„¤ì • - DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ì— ì‹¤í–‰
            setTimeout(() => {
                setupColumnFilters();
            }, 100);
            
            // ì™¸ë¶€ í´ë¦­ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.filter-button') && !e.target.closest('.filter-dropdown')) {
                    document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
                        dropdown.classList.remove('show');
                    });
                }
            });
        }

        function loadData() {
            filteredData = [...currentData];
            renderTable();
            updatePagination();
            updateResultsInfo();
            // DOMì´ ì¤€ë¹„ëœ í›„ì— í•„í„° ì´ˆê¸°í™”
            setTimeout(() => {
                initializeColumnFilters();
            }, 100);
        }

        function initializeColumnFilters() {
            // ê° ì»¬ëŸ¼ì˜ ê³ ìœ ê°’ë“¤ ìˆ˜ì§‘
            Object.keys(filterColumns).forEach(filterName => {
                const columnIndex = filterColumns[filterName];
                const uniqueValues = [...new Set(currentData.map(row => row[columnIndex]).filter(val => val && val.trim()))];
                console.log(`${filterName} ì»¬ëŸ¼ ê³ ìœ ê°’:`, uniqueValues); // ë””ë²„ê¹…ìš©
                
                // ë“œë¡­ë‹¤ìš´ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„ ì—…ë°ì´íŠ¸
                const dropdown = document.getElementById(`filter-${filterName}`);
                if (dropdown) {
                    updateFilterDropdown(filterName, uniqueValues);
                } else {
                    console.warn(`í•„í„° ë“œë¡­ë‹¤ìš´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: filter-${filterName}`);
                }
            });
        }

        function setupColumnFilters() {
            Object.keys(filterColumns).forEach(filterName => {
                const filterButton = document.querySelector(`[data-filter="${filterName}"]`);
                const dropdown = document.getElementById(`filter-${filterName}`);
                
                if (!filterButton) {
                    console.warn(`í•„í„° ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${filterName}`);
                    return;
                }
                
                if (!dropdown) {
                    console.warn(`í•„í„° ë“œë¡­ë‹¤ìš´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: filter-${filterName}`);
                    return;
                }
                
                filterButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ë“¤ ë‹«ê¸°
                    document.querySelectorAll('.filter-dropdown').forEach(dd => {
                        if (dd !== dropdown) dd.classList.remove('show');
                    });
                    
                    // í˜„ì¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
                    dropdown.classList.toggle('show');
                    
                    // ë“œë¡­ë‹¤ìš´ì´ ì—´ë¦´ ë•Œ ìœ„ì¹˜ ê³„ì‚° (fixed positioningìš©)
                    if (dropdown.classList.contains('show')) {
                        updateFilterDropdownData(filterName);
                        positionFixedDropdown(filterButton, dropdown);
                    }
                });
                
                // í•„í„° ê²€ìƒ‰
                const searchInput = dropdown.querySelector('.filter-search-input');
                if (searchInput) {
                    searchInput.addEventListener('input', () => {
                        filterDropdownOptions(filterName, searchInput.value);
                    });
                }
                
                // ì ìš© ë²„íŠ¼
                const applyBtn = dropdown.querySelector('.apply-btn');
                if (applyBtn) {
                    applyBtn.addEventListener('click', () => {
                        applyColumnFilter(filterName);
                        dropdown.classList.remove('show');
                    });
                }
                
                // ì „ì²´ì„ íƒ ë²„íŠ¼
                const clearBtn = dropdown.querySelector('.clear-btn');
                if (clearBtn) {
                    clearBtn.addEventListener('click', () => {
                        clearColumnFilter(filterName);
                    });
                }
            });
        }

        // fixed positioningì„ ìœ„í•œ ë“œë¡­ë‹¤ìš´ ìœ„ì¹˜ ê³„ì‚° í•¨ìˆ˜
        function positionFixedDropdown(button, dropdown) {
            const buttonRect = button.getBoundingClientRect();
            dropdown.style.left = buttonRect.left + 'px';
            dropdown.style.top = (buttonRect.bottom + 2) + 'px';
        }

        function updateFilterDropdown(filterName, values) {
            const dropdown = document.getElementById(`filter-${filterName}`);
            if (!dropdown) {
                console.error(`í•„í„° ë“œë¡­ë‹¤ìš´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: filter-${filterName}`);
                return;
            }
            
            const optionsContainer = dropdown.querySelector('.filter-options');
            if (!optionsContainer) {
                console.error(`ì˜µì…˜ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${filterName}`);
                return;
            }
            
            console.log(`${filterName} í•„í„° ì—…ë°ì´íŠ¸ ì¤‘...`, values); // ë””ë²„ê¹…ìš©
            
            // ê°’ë“¤ì„ ì •ë ¬
            values.sort();
            
            // ê°„ë‹¨í•œ HTML êµ¬ì¡°ë¡œ í…ŒìŠ¤íŠ¸
            const optionsHTML = values.map(value => {
                const escapedValue = value.replace(/"/g, '&quot;');
                const count = currentData.filter(row => row[filterColumns[filterName]] === value).length;
                const isChecked = columnFilters[filterName].size === 0 || columnFilters[filterName].has(value);
                
                return `
                    <div class="filter-option" data-value="${escapedValue}">
                        <input type="checkbox" ${isChecked ? 'checked' : ''} />
                        <span class="filter-option-text">${value}</span>
                        <span class="filter-option-count">(${count})</span>
                    </div>
                `;
            }).join('');
            
            console.log(`${filterName} ìƒì„±ëœ HTML:`, optionsHTML); // ì „ì²´ HTML í™•ì¸
            optionsContainer.innerHTML = optionsHTML;
            
            // DOMì— ì‹¤ì œë¡œ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸
            const addedOptions = optionsContainer.querySelectorAll('.filter-option');
            console.log(`${filterName} DOMì— ì¶”ê°€ëœ ì˜µì…˜ ìˆ˜:`, addedOptions.length);
            
            // ê° ì˜µì…˜ì˜ í…ìŠ¤íŠ¸ í™•ì¸
            addedOptions.forEach((option, index) => {
                const text = option.querySelector('.filter-option-text');
                console.log(`${filterName} ì˜µì…˜ ${index}:`, text ? text.textContent : 'text ì—†ìŒ');
            });
            
            // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            addedOptions.forEach(option => {
                const checkbox = option.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    checkbox.addEventListener('change', () => {
                        updateFilterButtonState(filterName);
                    });
                }
                
                option.addEventListener('click', (e) => {
                    if (e.target.type !== 'checkbox' && checkbox) {
                        checkbox.checked = !checkbox.checked;
                        updateFilterButtonState(filterName);
                    }
                });
            });
        }

        function updateFilterDropdownData(filterName) {
            const columnIndex = filterColumns[filterName];
            const currentFilteredData = getFilteredDataExcluding(filterName);
            const uniqueValues = [...new Set(currentFilteredData.map(row => row[columnIndex]).filter(val => val && val.trim()))];
            
            const dropdown = document.getElementById(`filter-${filterName}`);
            const optionsContainer = dropdown.querySelector('.filter-options');
            
            uniqueValues.sort();
            
            optionsContainer.innerHTML = uniqueValues.map(value => {
                const count = currentFilteredData.filter(row => row[columnIndex] === value).length;
                const isChecked = columnFilters[filterName].size === 0 || columnFilters[filterName].has(value);
                
                return `
                    <div class="filter-option" data-value="${value}">
                        <input type="checkbox" ${isChecked ? 'checked' : ''}>
                        <span class="filter-option-text" title="${value}">${value}</span>
                        <span class="filter-option-count">(${count})</span>
                    </div>
                `;
            }).join('');
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì¶”ê°€
            optionsContainer.querySelectorAll('.filter-option').forEach(option => {
                const checkbox = option.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('change', () => {
                    updateFilterButtonState(filterName);
                });
                
                option.addEventListener('click', (e) => {
                    if (e.target.type !== 'checkbox') {
                        checkbox.checked = !checkbox.checked;
                        updateFilterButtonState(filterName);
                    }
                });
            });
        }

        function filterDropdownOptions(filterName, searchTerm) {
            const dropdown = document.getElementById(`filter-${filterName}`);
            const options = dropdown.querySelectorAll('.filter-option');
            
            options.forEach(option => {
                const text = option.querySelector('.filter-option-text').textContent.toLowerCase();
                const isVisible = text.includes(searchTerm.toLowerCase());
                option.style.display = isVisible ? 'flex' : 'none';
            });
        }

        function updateFilterButtonState(filterName) {
            const filterButton = document.querySelector(`[data-filter="${filterName}"]`);
            const dropdown = document.getElementById(`filter-${filterName}`);
            const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]');
            const checkedBoxes = dropdown.querySelectorAll('input[type="checkbox"]:checked');
            
            if (checkedBoxes.length === 0 || checkedBoxes.length === checkboxes.length) {
                filterButton.classList.remove('active');
            } else {
                filterButton.classList.add('active');
            }
        }

        function applyColumnFilter(filterName) {
            const dropdown = document.getElementById(`filter-${filterName}`);
            const checkedOptions = dropdown.querySelectorAll('input[type="checkbox"]:checked');
            
            columnFilters[filterName].clear();
            checkedOptions.forEach(checkbox => {
                const value = checkbox.closest('.filter-option').dataset.value;
                columnFilters[filterName].add(value);
            });
            
            applyAllFilters();
            updateFilterButtonState(filterName);
        }

        function clearColumnFilter(filterName) {
            const dropdown = document.getElementById(`filter-${filterName}`);
            const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            
            columnFilters[filterName].clear();
            updateFilterButtonState(filterName);
        }

        function getFilteredDataExcluding(excludeFilter) {
            let data = [...currentData];
            
            // ê²€ìƒ‰ì–´ í•„í„° ì ìš©
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                data = data.filter(row => 
                    row.some(cell => cell.toString().toLowerCase().includes(searchTerm))
                );
            }
            
            // ì¹´í…Œê³ ë¦¬ í•„í„° ì ìš©
            const categoryFilter = document.getElementById('categoryFilter').value;
            if (categoryFilter) {
                data = data.filter(row => row[7].includes(categoryFilter));
            }
            
            // ë‹¤ë¥¸ ì»¬ëŸ¼ í•„í„°ë“¤ ì ìš© (í˜„ì¬ í•„í„° ì œì™¸)
            Object.keys(filterColumns).forEach(filterName => {
                if (filterName !== excludeFilter && columnFilters[filterName].size > 0) {
                    const columnIndex = filterColumns[filterName];
                    data = data.filter(row => columnFilters[filterName].has(row[columnIndex]));
                }
            });
            
            return data;
        }

        function handleSearch() {
            applyAllFilters();
        }

        function handleFilter() {
            applyAllFilters();
        }

        function applyAllFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            filteredData = currentData.filter(row => {
                // ê²€ìƒ‰ì–´ í•„í„°
                const matchesSearch = searchTerm === '' || row.some(cell => 
                    cell.toString().toLowerCase().includes(searchTerm)
                );
                
                // ì¹´í…Œê³ ë¦¬ í•„í„°
                const matchesCategory = categoryFilter === '' || row[7].includes(categoryFilter);
                
                // ì»¬ëŸ¼ í•„í„°ë“¤
                const matchesColumnFilters = Object.keys(filterColumns).every(filterName => {
                    if (columnFilters[filterName].size === 0) return true;
                    const columnIndex = filterColumns[filterName];
                    return columnFilters[filterName].has(row[columnIndex]);
                });
                
                return matchesSearch && matchesCategory && matchesColumnFilters;
            });
            
            currentPage = 1;
            renderTable();
            updatePagination();
            updateResultsInfo();
        }

        function handleSort(columnIndex) {
            if (sortColumn === columnIndex) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = columnIndex;
                sortDirection = 'asc';
            }

            filteredData.sort((a, b) => {
                let aVal = a[columnIndex];
                let bVal = b[columnIndex];

                // ìˆ«ìì¸ì§€ í™•ì¸
                const aNum = parseFloat(aVal);
                const bNum = parseFloat(bVal);
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    aVal = aNum;
                    bVal = bNum;
                } else {
                    aVal = aVal.toString().toLowerCase();
                    bVal = bVal.toString().toLowerCase();
                }

                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            updateSortIcons();
            renderTable();
        }

        function updateSortIcons() {
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
                if (parseInt(th.dataset.column) === sortColumn) {
                    th.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            });
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);

            if (pageData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; padding: 40px; color: #7f8c8d;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            tbody.innerHTML = pageData.map(row => 
                `<tr>
                    ${row.map((cell, index) => {
                        if (index === 10 && cell.startsWith('http')) {
                            return `<td><a href="${cell}" target="_blank" class="link-cell">${cell}</a></td>`;
                        }
                        return `<td title="${cell}">${cell}</td>`;
                    }).join('')}
                </tr>`
            ).join('');
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            
            document.getElementById('firstPage').disabled = currentPage === 1;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages || totalPages === 0;
            document.getElementById('lastPage').disabled = currentPage === totalPages || totalPages === 0;
            
            document.getElementById('pageInfo').textContent = `${currentPage} / ${Math.max(1, totalPages)}`;
        }

        function updateResultsInfo() {
            const total = filteredData.length;
            const start = Math.min((currentPage - 1) * itemsPerPage + 1, total);
            const end = Math.min(currentPage * itemsPerPage, total);
            
            if (total === 0) {
                document.getElementById('resultsInfo').textContent = 'ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ';
            } else {
                document.getElementById('resultsInfo').textContent = `${start}-${end} / ì´ ${total.toLocaleString()}ê°œ`;
            }
        }

        function goToPage(page) {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderTable();
                updatePagination();
                updateResultsInfo();
            }
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            let i = 0;
            
            while (i < line.length) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && i + 1 < line.length && line[i + 1] === '"') {
                        // ë”°ì˜´í‘œ ì´ìŠ¤ì¼€ì´í”„ ("" -> ")
                        current += '"';
                        i += 2;
                    } else {
                        // ë”°ì˜´í‘œ ì‹œì‘/ë
                        inQuotes = !inQuotes;
                        i++;
                    }
                } else if (char === ',' && !inQuotes) {
                    // ì»¬ëŸ¼ êµ¬ë¶„ì
                    result.push(current.trim());
                    current = '';
                    i++;
                } else {
                    current += char;
                    i++;
                }
            }
            
            // ë§ˆì§€ë§‰ ì»¬ëŸ¼ ì¶”ê°€
            result.push(current.trim());
            
            return result;
        }

        // ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ë¥¼ ìœ„í•œ ì„±ëŠ¥ ìµœì í™”
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);

            if (pageData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; padding: 40px; color: #7f8c8d;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            // ì„±ëŠ¥ ìµœì í™”: DocumentFragment ì‚¬ìš©
            const fragment = document.createDocumentFragment();
            
            pageData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = row.map((cell, index) => {
                    if (index === 10 && cell && cell.startsWith('http')) {
                        return `<td><a href="${cell}" target="_blank" rel="noopener noreferrer" class="link-cell">${cell}</a></td>`;
                    }
                    const cellContent = cell || '';
                    const displayContent = cellContent.length > 50 ? cellContent.substring(0, 50) + '...' : cellContent;
                    return `<td title="${cellContent}">${displayContent}</td>`;
                }).join('');
                fragment.appendChild(tr);
            });
            
            tbody.innerHTML = '';
            tbody.appendChild(fragment);
        }
    </script>
</body>
</html>